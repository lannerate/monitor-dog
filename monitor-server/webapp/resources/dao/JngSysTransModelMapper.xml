<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.heagle.monitor.dao.JngSysTransDao" >
  <resultMap id="BaseResultMap" type="com.heagle.monitor.base.model.JngSysTransModel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="jngSysTrans_TRANS_JNLS_NO" property="transJnlsNo" jdbcType="VARCHAR" />
    <result column="jngSysTrans_ONLINE_JNLS_NO" property="onlineJnlsNo" jdbcType="VARCHAR" />
    <result column="jngSysTrans_SESSION_ID" property="sessionId" jdbcType="VARCHAR" />
    <result column="jngSysTrans_OPER_NO" property="operNo" jdbcType="VARCHAR" />
    <result column="jngSysTrans_REQUEST_URL" property="requestUrl" jdbcType="VARCHAR" />
    <result column="jngSysTrans_PROCESS_CODE" property="processCode" jdbcType="VARCHAR" />
    <result column="jngSysTrans_REQUEST_CONTENT" property="requestContent" jdbcType="VARCHAR" />
    <result column="jngSysTrans_TRANS_BEGIN_TIME" property="transBeginTime" jdbcType="DATE" />
    <result column="jngSysTrans_TRANS_END_TIME" property="transEndTime" jdbcType="DATE" />
    <result column="jngSysTrans_OPER_CHECK_STATUS" property="operCheckStatus" jdbcType="VARCHAR" />
    <result column="jngSysTrans_OPER_CHECK_TIME" property="operCheckTime" jdbcType="DATE" />
    <result column="REQUEST_CHECK_STATUS" property="requestCheckStatus" jdbcType="VARCHAR" />
    <result column="REQUEST_CHECK_TIME" property="requestCheckTime" jdbcType="DATE" />
    <result column="jngSysTrans_AUTH_CHECK_STATUS" property="authCheckStatus" jdbcType="VARCHAR" />
    <result column="jngSysTrans_AUTH_CHECK_TIME" property="authCheckTime" jdbcType="DATE" />
    <result column="jngSysTrans_JSON_CHECK_STATUS" property="jsonCheckStatus" jdbcType="VARCHAR" />
    <result column="jngSysTrans_JSON_CHECK_TIME" property="jsonCheckTime" jdbcType="DATE" />
    <result column="jngSysTrans_TRANS_STATUS" property="transStatus" jdbcType="DECIMAL" />
    <result column="jngSysTrans_ERROR_MESS" property="errorMess" jdbcType="VARCHAR" />
    <result column="jngSysTrans_APP_TRANS_JNLS_NO" property="appTransJnlsNo" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="TopResultMap" type="com.heagle.monitor.base.model.TopTranModel">
      <result column="process_code" property="processCode" jdbcType="VARCHAR" />
      <result column="top_count" property="topCount" jdbcType="DECIMAL" />
  </resultMap>

  <resultMap id="TopDurationResultMap" type="com.heagle.monitor.base.model.TopDurationTranModel">
      <result column="trans_jnls_no" property="tranNo" jdbcType="VARCHAR" />
      <result column="process_code" property="processCode" jdbcType="VARCHAR" />
      <result column="duration" property="duration" jdbcType="DECIMAL" />
      <result column="rownum" property="topLevel" jdbcType="DECIMAL" />
  </resultMap>

  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    jngSysTrans.TRANS_JNLS_NO as jngSysTrans_TRANS_JNLS_NO, jngSysTrans.ONLINE_JNLS_NO as jngSysTrans_ONLINE_JNLS_NO, 
    jngSysTrans.SESSION_ID as jngSysTrans_SESSION_ID, jngSysTrans.OPER_NO as jngSysTrans_OPER_NO, 
    jngSysTrans.REQUEST_URL as jngSysTrans_REQUEST_URL, jngSysTrans.PROCESS_CODE as jngSysTrans_PROCESS_CODE, 
    jngSysTrans.REQUEST_CONTENT as jngSysTrans_REQUEST_CONTENT, jngSysTrans.TRANS_BEGIN_TIME as jngSysTrans_TRANS_BEGIN_TIME, 
    jngSysTrans.TRANS_END_TIME as jngSysTrans_TRANS_END_TIME, jngSysTrans.OPER_CHECK_STATUS as jngSysTrans_OPER_CHECK_STATUS, 
    jngSysTrans.OPER_CHECK_TIME as jngSysTrans_OPER_CHECK_TIME, jngSysTrans.REQUEST_CHECK_STATUS as REQUEST_CHECK_STATUS,
    jngSysTrans.REQUEST_CHECK_TIME as REQUEST_CHECK_TIME, jngSysTrans.AUTH_CHECK_STATUS as jngSysTrans_AUTH_CHECK_STATUS,
    jngSysTrans.AUTH_CHECK_TIME as jngSysTrans_AUTH_CHECK_TIME, jngSysTrans.JSON_CHECK_STATUS as jngSysTrans_JSON_CHECK_STATUS, 
    jngSysTrans.JSON_CHECK_TIME as jngSysTrans_JSON_CHECK_TIME, jngSysTrans.TRANS_STATUS as jngSysTrans_TRANS_STATUS, 
    jngSysTrans.ERROR_MESS as jngSysTrans_ERROR_MESS, jngSysTrans.APP_TRANS_JNLS_NO as jngSysTrans_APP_TRANS_JNLS_NO
  </sql>
  <select id="queryJngSysTrans" resultMap="BaseResultMap" parameterType="com.heagle.monitor.base.model.JngSysTransModelCriteria" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from JNG_SYS_TRANS_LIST jngSysTrans
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="countJngSysTrans" parameterType="com.heagle.monitor.base.model.JngSysTransModelCriteria" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(distinct trans_jnls_no) from JNG_SYS_TRANS_LIST jngSysTrans
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>

<select id="getTopTrans"  resultMap="TopResultMap" parameterType="int" >
      select process_code,top_count from
       (
       select
       tt.*,rownum rn  from (
       select t.process_code, count( distinct t.trans_jnls_no) as top_count
       from JNG_SYS_TRANS_LIST t
       where substr(t.process_code, 0, 4) in ('LOAN', 'RISK', 'CSWP') and t.trans_jnls_no  is not null
       group by t.process_code
       order by top_count desc) tt
       )
    <where >
        <if test ="value !=null">
         <![CDATA[rn <= #{value}]]>
        </if>
    </where>
</select>

 <select id="getTopDurationTrans"  resultMap="TopDurationResultMap" parameterType="int" >
       select tt.*,rownum
       from (select t.trans_jnls_no,
       t.process_code,
       (t.trans_end_time - t.trans_begin_time) * 24 * 3600 as duration
       from JNG_SYS_TRANS_LIST t
       where trans_jnls_no is not null
       and t.trans_end_time is not null
       and t.trans_end_time > sysdate -1
       order by duration desc) tt
    <where >
        <if test ="value !=null">
         <![CDATA[rownum <= #{value}]]>
        </if>
    </where>
</select>

</mapper>